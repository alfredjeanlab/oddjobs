{
  "command": {
    "build": {
      "args": "<name> <prompt>",
      "run": { "job": "build" },
      "defaults": {
        "branch": "main"
      }
    }
  },
  "job": {
    "build": {
      "input": ["name", "prompt"],
      "step": [
        {
          "name": "init",
          "run": "git worktree add worktrees/${name} -b feature/${name}",
          "on_done": { "step": "plan" }
        },
        {
          "name": "plan",
          "run": { "agent": "planner" },
          "on_done": { "step": "execute" }
        },
        {
          "name": "execute",
          "run": { "agent": "executor" },
          "on_done": { "step": "done" },
          "on_fail": { "step": "failed" }
        },
        {
          "name": "done",
          "run": "echo done"
        },
        {
          "name": "failed",
          "run": "echo failed"
        }
      ]
    }
  },
  "agent": {
    "planner": {
      "run": "claude -p \"Plan: ${prompt}\"",
      "env": {
        "OJ_STEP": "plan"
      }
    },
    "executor": {
      "run": "claude \"${prompt}\"",
      "cwd": "worktrees/${name}"
    }
  }
}
